<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find and Highlight Words in Multiple Text Files</title>
    <style>
        .highlight {
            background-color: yellow;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h2>Find and Highlight Words in Multiple Files</h2>

    <!-- File input -->
    <input type="file" id="fileInput" multiple accept=".txt" />
    
    <!-- Search terms container -->
    <div id="searchTermsContainer">
        <label for="searchWord1">Enter search term 1:</label>
        <input type="text" class="searchWord" id="searchWord1" placeholder="Enter search term" />
    </div>
    
    <!-- Button to add more search fields -->
    <button type="button" id="addButton">+ Add another search term</button>
    
    <button onclick="findParagraphsInFiles()">Find and Highlight</button>
    
    <!-- Output section -->
    <pre id="output"></pre>

    <script>
        let searchTermCount = 1; // Track number of search terms

        // Function to add a new search term input field
        function addSearchTerm() {
            searchTermCount++;
            const searchTermsContainer = document.getElementById('searchTermsContainer');
            
            const newSearchField = document.createElement('div');
            newSearchField.innerHTML = `
                <label for="searchWord${searchTermCount}">Enter search term ${searchTermCount}:</label>
                <input type="text" class="searchWord" id="searchWord${searchTermCount}" placeholder="Enter search term" />
            `;
            
            searchTermsContainer.appendChild(newSearchField);
        }

        // Attach event listener to the button for adding new search fields
        document.getElementById('addButton').addEventListener('click', addSearchTerm);

        function findParagraphsInFiles() {
            const fileInput = document.getElementById('fileInput');
            const output = document.getElementById('output');
            const files = fileInput.files;

            // Get all search terms from dynamically created inputs
            const searchTerms = Array.from(document.querySelectorAll('.searchWord')).map(input => input.value);

            if (!files.length) {
                output.textContent = "Please select one or more text files.";
                return;
            }

            output.textContent = ''; // Clear previous output
            let processedFiles = 0;

            // Loop through all selected files
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();

                reader.onload = function(e) {
                    const text = e.target.result;
                    
                    // Split the content into paragraphs based on pattern
                    const paragraphs = text.split(/(?=Request Url :)/g);

                    output.innerHTML += `<br>--- Results for file: ${file.name} ---<br>`;

                    let foundParagraphs = [];
                    let occurrences = 0; // Counter for occurrences of all search terms

                    // Search for paragraphs containing all search terms
                    paragraphs.forEach(paragraph => {
                        const allTermsFound = searchTerms.every(term => paragraph.includes(term)); // Check if all terms are found
                        
                        if (allTermsFound) {
                            // Highlight search terms within the paragraph
                            let highlightedParagraph = paragraph;
                            searchTerms.forEach(term => {
                                const regex = new RegExp(`(${term})`, 'gi');
                                highlightedParagraph = highlightedParagraph.replace(regex, '<span class="highlight">$1</span>');
                            });

                            foundParagraphs.push(highlightedParagraph);
                            occurrences++; // Increment the counter if all terms are found
                        }
                    });

                    // Display results for the current file
                    if (foundParagraphs.length > 0) {
                        foundParagraphs.forEach((paragraph, index) => {
                            output.innerHTML += `--- Matching Paragraph ${index + 1} ---<br>${paragraph}<br><br>`;
                        });
                        output.innerHTML += `Total occurrences: ${occurrences}<br>`; // Show total occurrences
                    } else {
                        output.innerHTML += `No paragraph contains all search terms.<br>`;
                    }

                    processedFiles++;
                    // Show a message when all files have been processed
                    if (processedFiles === files.length) {
                        output.innerHTML += `<br>Processed ${files.length} file(s).`;
                    }
                };

                reader.onerror = function() {
                    output.textContent += `Error reading file: ${file.name}\n`;
                    processedFiles++;
                };

                reader.readAsText(file); // Read the file as text
            }
        }
    </script>
</body>
</html>
